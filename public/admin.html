<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/admin-guard.js"></script>
</head>
<body>
    <header>
        <img src="images/faenlogo.png" alt="Logo FAEN" class="logo">
        <div class="header-content">
            <h1>üì∞ Panel de Administraci√≥n</h1>
            <p class="subtitle">Gestiona tu sitio web</p>
            <button class="menu-toggle-admin" id="menu-toggle-admin">‚ò∞</button>
        </div>
        <!-- Info usuario + logout ‚Äî se puebla en DOMContentLoaded -->
        <div id="header-user-info" style="position:absolute;right:20px;top:0;height:100%;display:flex;align-items:center;gap:12px;">
            <div style="text-align:right;line-height:1.3;">
                <div style="font-weight:600;color:white;font-size:0.95rem;" id="header-username">‚Äî</div>
                <div style="font-size:0.75rem;color:rgba(255,255,255,0.75);" id="header-userrole"></div>
            </div>
            <button id="btn-logout-header" onclick="logout()"
                style="padding:8px 16px;background:#e74c3c;color:white;border:none;border-radius:5px;cursor:pointer;font-size:0.9rem;white-space:nowrap;">
                üö™ Salir
            </button>
        </div>
    </header>

    <main class="dashboard-container">
        <aside class="dashboard-sidebar">
            <nav class="dashboard-nav">
                <a href="#" class="nav-item active" data-section="noticias"
                   data-permission-module="noticias" data-permission-level="read">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Noticias</span>
                </a>
                <a href="#" class="nav-item" data-section="galeria"
                   data-permission-module="galeria" data-permission-level="read">
                    <span class="nav-icon">üñºÔ∏è</span>
                    <span class="nav-text">Galer√≠a</span>
                </a>
                <a href="#" class="nav-item" data-section="documentos"
                   data-permission-module="documentos" data-permission-level="read">
                    <span class="nav-icon">üìÑ</span>
                    <span class="nav-text">Documentos</span>
                </a>
                <a href="#" class="nav-item" data-section="carreras"
                   data-permission-module="carreras" data-permission-level="read">
                    <span class="nav-icon">üéì</span>
                    <span class="nav-text">Carreras</span>
                </a>
                <a href="#" class="nav-item" data-section="autoridades"
                   data-permission-module="autoridades" data-permission-level="read">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Autoridades</span>
                </a>
                <a href="#" class="nav-item" data-section="mensajes"
                   data-permission-module="mensajes" data-permission-level="read">
                    <span class="nav-icon">üìß</span>
                    <span class="nav-text">Mensajes</span>
                </a>
                <a href="#" class="nav-item" data-section="configuracion"
                   data-permission-module="config" data-permission-level="read">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Configuraci√≥n</span>
                </a>
                <a href="#" class="nav-item" data-section="usuarios"
                   data-permission-module="usuarios" data-permission-level="read">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-text">Usuarios y Roles</span>
                </a>
                <a href="index.html" class="nav-item">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Ver Sitio</span>
                </a>
            </nav>
        </aside>

        <div class="dashboard-content">

            <!-- ===================== NOTICIAS ===================== -->
            <section class="dashboard-section active" id="section-noticias"
                     data-permission-module="noticias" data-permission-level="read">
                <div class="section-header">
                    <h2>Gestionar Noticias</h2>
                    <button id="btn-nueva-noticia" class="btn btn-primary btn-large"
                            data-permission-module="noticias" data-permission-level="create"
                            data-permission-button="true">
                        ‚ûï Nueva Noticia
                    </button>
                </div>
                <div id="modal-noticia" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modal-titulo">Nueva Noticia</h3>
                            <button class="modal-close" id="modal-close">&times;</button>
                        </div>
                        <form id="news-form" enctype="multipart/form-data" class="modal-form">
                            <div class="form-group">
                                <label for="news-title">T√≠tulo *</label>
                                <input type="text" id="news-title" placeholder="T√≠tulo de la noticia" required>
                            </div>
                            <div class="form-group">
                                <label for="news-date">Fecha de publicaci√≥n *</label>
                                <input type="date" id="news-date" required>
                            </div>
                            <div class="form-group">
                                <label for="news-description">Descripci√≥n *</label>
                                <textarea id="news-description" placeholder="Descripci√≥n de la noticia" required rows="6"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="news-image">Imagen (opcional)</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="news-image" accept="image/*" class="file-input">
                                    <label for="news-image" class="file-label">Seleccionar imagen</label>
                                    <span id="file-name" class="file-name">Ning√∫n archivo seleccionado</span>
                                </div>
                                <div id="image-preview" class="image-preview"></div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Guardar Noticia</button>
                                <button type="button" id="form-cancel" class="btn btn-secondary">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="noticias-table">
                        <thead>
                            <tr>
                                <th>Imagen</th><th>T√≠tulo</th><th>Fecha</th><th>Descripci√≥n</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-news-list">
                            <tr><td colspan="5" class="text-center">Cargando noticias...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ===================== GALER√çA ===================== -->
            <section class="dashboard-section" id="section-galeria"
                     data-permission-module="galeria" data-permission-level="read">
                <div class="section-header">
                    <h2>Gestor de Fotos</h2>
                    <button id="btn-subir-foto" class="btn btn-primary btn-large"
                            data-permission-module="galeria" data-permission-level="create"
                            data-permission-button="true">
                        üì§ Subir Foto
                    </button>
                </div>
                <div id="modal-foto" class="modal">
                    <div class="modal-content modal-foto-content">
                        <div class="modal-header">
                            <h3>Subir Foto</h3>
                            <button class="modal-close" id="modal-foto-close">&times;</button>
                        </div>
                        <form id="foto-form" enctype="multipart/form-data" class="modal-form">
                            <div class="form-group">
                                <label for="foto-titulo">T√≠tulo de la foto</label>
                                <input type="text" id="foto-titulo" placeholder="Ej: Evento del mes">
                            </div>
                            <div class="form-group">
                                <label for="foto-file">Foto *</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="foto-file" accept="image/*" class="file-input" required>
                                    <label for="foto-file" class="file-label">Seleccionar foto</label>
                                    <span id="foto-file-name" class="file-name">Ning√∫n archivo seleccionado</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Subir Foto</button>
                                <button type="button" id="foto-form-cancel" class="btn btn-secondary">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="galeria-admin-container" class="galeria-admin-grid"></div>
            </section>

            <!-- ===================== DOCUMENTOS ===================== -->
            <section class="dashboard-section" id="section-documentos"
                     data-permission-module="documentos" data-permission-level="read">
                <div class="section-header">
                    <h2>Gestionar Documentos</h2>
                    <button id="btn-nuevo-documento" class="btn btn-primary btn-large"
                            data-permission-module="documentos" data-permission-level="create"
                            data-permission-button="true">
                        ‚ûï Nuevo Documento
                    </button>
                </div>
                <div id="modal-documento" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modal-doc-titulo">Nuevo Documento</h3>
                            <button class="modal-close" id="modal-doc-close">&times;</button>
                        </div>
                        <form id="documento-form" enctype="multipart/form-data" class="modal-form">
                            <div class="form-group">
                                <label for="doc-title">T√≠tulo *</label>
                                <input type="text" id="doc-title" placeholder="Ej: Constancia de Inscripci√≥n 2025" required>
                            </div>
                            <div class="form-group">
                                <label for="doc-category">Categor√≠a *</label>
                                <select id="doc-category" required>
                                    <option value="">Seleccionar categor√≠a</option>
                                    <option value="constancias">üìú Constancias</option>
                                    <option value="formularios">üìù Formularios</option>
                                    <option value="reglamentos">üìó Reglamentos</option>
                                    <option value="notas">üìã Modelo de Notas</option>
                                    <option value="guias">üìñ Gu√≠as de Ayuda</option>
                                    <option value="otros">üìÅ Otros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="doc-description">Descripci√≥n</label>
                                <textarea id="doc-description" placeholder="Descripci√≥n del documento" rows="4"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="doc-file">Archivo PDF *</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="doc-file" accept=".pdf" class="file-input" required>
                                    <label for="doc-file" class="file-label">Seleccionar PDF</label>
                                    <span id="doc-file-name" class="file-name">Ning√∫n archivo seleccionado</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Guardar Documento</button>
                                <button type="button" id="doc-form-cancel" class="btn btn-secondary">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="documentos-table">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th><th>Categor√≠a</th><th>Descripci√≥n</th><th>Fecha</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-docs-list">
                            <tr><td colspan="5" class="text-center">Cargando documentos...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ===================== CARRERAS ===================== -->
            <section class="dashboard-section" id="section-carreras"
                     data-permission-module="carreras" data-permission-level="read">
                <div class="section-header">
                    <h2>Gestionar Carreras</h2>
                    <button id="btn-nueva-carrera" class="btn btn-primary btn-large"
                            data-permission-module="carreras" data-permission-level="create"
                            data-permission-button="true">
                        ‚ûï Nueva Carrera
                    </button>
                </div>
                <div id="modal-carrera" class="modal">
                    <div class="modal-content" style="max-width:700px;">
                        <div class="modal-header">
                            <h3 id="modal-carrera-titulo">Nueva Carrera</h3>
                            <button class="modal-close" id="modal-carrera-close">&times;</button>
                        </div>
                        <form id="carrera-form" enctype="multipart/form-data" class="modal-form">
                            <div class="form-group">
                                <label for="carrera-name">Nombre *</label>
                                <input type="text" id="carrera-name" placeholder="Nombre de la carrera" required>
                            </div>
                            <div class="form-group">
                                <label for="carrera-code">C√≥digo</label>
                                <input type="text" id="carrera-code" placeholder="Ej: LIC-ADM">
                            </div>
                            <div class="form-group">
                                <label for="carrera-category">Categor√≠a *</label>
                                <select id="carrera-category" required>
                                    <option value="grado">Grado</option>
                                    <option value="posgrado">Posgrado</option>
                                    <option value="cursos">Cursos y Extensi√≥n</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="carrera-description">Descripci√≥n corta *</label>
                                <textarea id="carrera-description" placeholder="Descripci√≥n breve" required rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="carrera-full-description">Descripci√≥n completa</label>
                                <textarea id="carrera-full-description" placeholder="Descripci√≥n completa" rows="6"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="carrera-duration">Duraci√≥n</label>
                                <input type="text" id="carrera-duration" placeholder="Ej: 4 a√±os">
                            </div>
                            <div class="form-group">
                                <label for="carrera-documento">Plan de Carrera (PDF)</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="carrera-documento" accept=".pdf" class="file-input">
                                    <label for="carrera-documento" class="file-label">Seleccionar PDF</label>
                                    <span id="carrera-doc-name" class="file-name">Ning√∫n archivo seleccionado</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Guardar Carrera</button>
                                <button type="button" id="carrera-form-cancel" class="btn btn-secondary">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="carreras-table">
                        <thead>
                            <tr>
                                <th>Nombre</th><th>C√≥digo</th><th>Categor√≠a</th><th>Descripci√≥n</th><th>Duraci√≥n</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-carreras-list">
                            <tr><td colspan="6" class="text-center">Cargando carreras...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ===================== AUTORIDADES ===================== -->
            <section class="dashboard-section" id="section-autoridades"
                     data-permission-module="autoridades" data-permission-level="read">
                <div class="section-header">
                    <h2>Gestionar Autoridades</h2>
                    <button id="btn-nueva-autoridad" class="btn btn-primary btn-large"
                            data-permission-module="autoridades" data-permission-level="create"
                            data-permission-button="true">
                        ‚ûï Nueva Autoridad
                    </button>
                </div>
                <div id="modal-autoridad" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modal-autoridad-titulo">Nueva Autoridad</h3>
                            <button class="modal-close" id="modal-autoridad-close">&times;</button>
                        </div>
                        <form id="autoridad-form" enctype="multipart/form-data" class="modal-form">
                            <div class="form-group">
                                <label for="autoridad-nombre">Nombre completo *</label>
                                <input type="text" id="autoridad-nombre" placeholder="Nombre y apellido" required>
                            </div>
                            <div class="form-group">
                                <label for="autoridad-cargo">Cargo *</label>
                                <input type="text" id="autoridad-cargo" placeholder="Ej: Decano" required>
                            </div>
                            <div class="form-group">
                                <label for="autoridad-email">Email</label>
                                <input type="email" id="autoridad-email" placeholder="correo@ejemplo.com">
                            </div>
                            <div class="form-group">
                                <label for="autoridad-telefono">Tel√©fono</label>
                                <input type="text" id="autoridad-telefono" placeholder="Ej: +54 9 11 1234-5678">
                            </div>
                            <div class="form-group">
                                <label for="autoridad-orden">Orden de aparici√≥n</label>
                                <input type="number" id="autoridad-orden" placeholder="Ej: 1" min="1" class="form-input" style="max-width: 100px;">
                            </div>
                            <div class="form-group">
                                <label for="autoridad-foto">Foto</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="autoridad-foto" accept="image/*" class="file-input">
                                    <label for="autoridad-foto" class="file-label">Seleccionar foto</label>
                                    <span id="autoridad-foto-name" class="file-name">Ning√∫n archivo seleccionado</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Guardar Autoridad</button>
                                <button type="button" id="autoridad-form-cancel" class="btn btn-secondary">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="autoridades-table">
                        <thead>
                            <tr>
                                <th>Foto</th><th>Nombre</th><th>Cargo</th><th>Email</th><th>Tel√©fono</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-autoridades-list">
                            <tr><td colspan="6" class="text-center">Cargando autoridades...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ===================== MENSAJES ===================== -->
            <section class="dashboard-section" id="section-mensajes"
                     data-permission-module="mensajes" data-permission-level="read">
                <div class="section-header">
                    <h2>Mensajes de Contacto</h2>
                    <p style="font-size:0.9rem;color:#666;margin:0;">
                        <span id="mensajes-no-leidos">0</span> sin leer
                    </p>
                    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
                        <label style="font-size:0.85rem;color:#666;">Desde <input id="export-desde" type="date" style="margin-left:6px;"/></label>
                        <label style="font-size:0.85rem;color:#666;">Hasta <input id="export-hasta" type="date" style="margin-left:6px;"/></label>
                        <label style="font-size:0.85rem;color:#666;">Estado
                            <select id="export-estado" style="margin-left:6px;padding:4px;">
                                <option value="all">Todos</option>
                                <option value="no-leido">Sin leer</option>
                                <option value="leido">Le√≠dos</option>
                            </select>
                        </label>
                        <button id="export-mensajes-csv" class="btn btn-secondary">‚¨áÔ∏è Exportar CSV</button>
                        <button id="export-mensajes-xlsx" class="btn btn-secondary">‚¨áÔ∏è Exportar Excel</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="mensajes-table">
                        <thead>
                            <tr>
                                <th>Estado</th><th>Nombre</th><th>Email</th><th>Asunto</th><th>Fecha</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-mensajes-list">
                            <tr><td colspan="6" class="text-center">Cargando mensajes...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ===================== USUARIOS Y ROLES ===================== -->
            <section class="dashboard-section" id="section-usuarios"
                     data-permission-module="usuarios" data-permission-level="read">
                <div class="section-header">
                    <h2>Usuarios y Roles</h2>
                </div>
                <div style="display:flex;gap:10px;margin-bottom:20px;">
                    <button id="tab-usuarios-btn" class="btn btn-primary" onclick="showTab('usuarios')">üë§ Usuarios</button>
                    <button id="tab-roles-btn" class="btn btn-secondary" onclick="showTab('roles')">üîë Roles</button>
                </div>

                <!-- TAB: USUARIOS -->
                <div id="usuarios-tab" class="tab-content tab-active" style="display:block;">
                    <div style="margin-bottom:15px;">
                        <button id="btn-nuevo-usuario" class="btn btn-primary btn-large"
                                data-permission-module="usuarios" data-permission-level="create"
                                data-permission-button="true"
                                onclick="openUserModal()">
                            ‚ûï Nuevo Usuario
                        </button>
                    </div>
                    <div id="modal-usuario" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="modal-titulo-usuario">Nuevo Usuario</h3>
                                <button class="modal-close" onclick="closeUserModal()">&times;</button>
                            </div>
                            <form id="user-form" enctype="multipart/form-data" class="modal-form">
                                <div class="form-group">
                                    <label for="user-username">Usuario *</label>
                                    <input type="text" id="user-username" placeholder="Nombre de usuario" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-email">Email *</label>
                                    <input type="email" id="user-email" placeholder="correo@ejemplo.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-password">Contrase√±a *</label>
                                    <input type="password" id="user-password" placeholder="Contrase√±a" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-role">Rol *</label>
                                    <select id="user-role" required>
                                        <option value="">-- Selecciona un rol --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="user-enabled">
                                        <input type="checkbox" id="user-enabled" class="checkbox-input" checked>
                                        <span>Usuario Activo</span>
                                    </label>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-success">Guardar Usuario</button>
                                    <button type="button" onclick="closeUserModal()" class="btn btn-secondary">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="usuarios-table">
                            <thead>
                                <tr>
                                    <th>Usuario</th><th>Email</th><th>Rol</th><th>Estado</th><th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usuarios-tbody">
                                <tr><td colspan="5" class="text-center">Cargando usuarios...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB: ROLES -->
                <div id="roles-tab" class="tab-content" style="display:none;">
                    <div style="margin-bottom:15px;">
                        <button id="btn-nuevo-rol" class="btn btn-primary btn-large" onclick="openRoleModal()">
                            ‚ûï Nuevo Rol
                        </button>
                    </div>
                    <div id="modal-rol" class="modal">
                        <div class="modal-content" style="width:700px;max-height:90vh;overflow-y:auto;">
                            <div class="modal-header">
                                <h3 id="modal-titulo-rol">Nuevo Rol</h3>
                                <button class="modal-close" onclick="closeRoleModal()">&times;</button>
                            </div>
                            <form id="role-form" class="modal-form">
                                <div class="form-group">
                                    <label for="role-name">Nombre del Rol *</label>
                                    <input type="text" id="role-name" placeholder="Ej: Editor" required>
                                </div>
                                <div class="form-group">
                                    <label for="role-description">Descripci√≥n *</label>
                                    <textarea id="role-description" placeholder="Descripci√≥n del rol" required rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Permisos por M√≥dulo *</label>
                                    <div id="role-permissions-container" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;"></div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-success">Guardar Rol</button>
                                    <button type="button" onclick="closeRoleModal()" class="btn btn-secondary">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="roles-table">
                            <thead>
                                <tr><th>Nombre</th><th>Descripci√≥n</th><th>Acciones</th></tr>
                            </thead>
                            <tbody id="roles-tbody">
                                <tr><td colspan="3" class="text-center">Cargando roles...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ===================== CONFIGURACI√ìN ===================== -->
            <section class="dashboard-section" id="section-configuracion"
                     data-permission-module="config" data-permission-level="read">
                <div class="section-header">
                    <h2>Configuraci√≥n del Sitio</h2>
                </div>

                <div class="config-card">
                    <h3>üîó Preinscripci√≥n</h3>
                    <p class="config-description">Habilita o deshabilita el enlace de preinscripci√≥n en la p√°gina principal</p>
                    <div class="form-group">
                        <label for="config-preinscripcion-enabled">
                            <input type="checkbox" id="config-preinscripcion-enabled" class="checkbox-input">
                            <span>Habilitar Preinscripci√≥n</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="config-preinscripcion-url">URL de Preinscripci√≥n</label>
                        <input type="url" id="config-preinscripcion-url" placeholder="https://..." class="form-input">
                    </div>
                    <div class="form-actions">
                        <button id="btn-save-preinscripcion" class="btn btn-primary"
                                data-permission-module="config" data-permission-level="update"
                                data-permission-button="true">
                            üíæ Guardar
                        </button>
                    </div>
                </div>

                <div class="config-card" style="margin-top:20px;">
                    <h3>üìö Enlaces para Claustros</h3>
                    <p class="config-description">Administr√° los enlaces del men√∫ Claustro para cada grupo</p>
                    <div class="form-group">
                        <label for="claustro-select">Claustro</label>
                        <select id="claustro-select" class="form-input">
                            <option value="">-- Seleccionar claustro --</option>
                        </select>
                    </div>
                    <div id="claustro-form-container" style="display:none;">
                        <div class="form-group">
                            <label for="claustro-link-nombre">Nombre del enlace *</label>
                            <input type="text" id="claustro-link-nombre" placeholder="Ej: Aula Virtual" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="claustro-link-url">URL *</label>
                            <input type="url" id="claustro-link-url" placeholder="https://..." class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="claustro-link-icono">Emoji/Icono</label>
                            <input type="text" id="claustro-link-icono" placeholder="üíª" maxlength="2" class="form-input" style="max-width:100px;">
                        </div>
                        <div class="form-actions">
                            <button id="btn-agregar-claustro-link" class="btn btn-primary"
                                    data-permission-module="config" data-permission-level="update"
                                    data-permission-button="true">
                                ‚ûï Agregar enlace
                            </button>
                        </div>
                        <div id="claustro-link-add-message" class="message" style="display:none;margin-top:10px;"></div>
                    </div>
                    <div style="border-top:1px solid #ddd;padding-top:20px;display:none;" id="claustro-links-container">
                        <h4>Enlaces de <span id="claustro-nombre-display"></span></h4>
                        <div id="claustro-links-list" style="display:grid;gap:10px;">
                            <p style="color:#999;">Cargando enlaces...</p>
                        </div>
                    </div>
                </div>
            </section>

        </div><!-- fin dashboard-content -->
    </main>

    <script src="js/auth.js"></script>
    <script src="js/users-admin.js"></script>
    <script src="js/app.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ‚îÄ‚îÄ Nombre y rol del usuario en el header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const user = JSON.parse(localStorage.getItem('faen_auth_user') || 'null');
        if (user) {
            document.getElementById('header-username').textContent = 'üë§ ' + user.username;
            document.getElementById('header-userrole').textContent = user.role;
        }

        // ‚îÄ‚îÄ Permisos y visibilidad ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        setUserInfo();
        updatePermissionVisibility();

        // ‚îÄ‚îÄ Activar la primera secci√≥n con acceso ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const todosLosNavItems = Array.from(document.querySelectorAll('.nav-item[data-section]'));
        const primerItemVisible = todosLosNavItems.find(item => item.style.display !== 'none');

        if (primerItemVisible) {
            document.querySelectorAll('.dashboard-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const sectionId = primerItemVisible.dataset.section;
            const section = document.getElementById('section-' + sectionId);
            if (section) section.classList.add('active');
            primerItemVisible.classList.add('active');
        }
    });

    function showTab(tab) {
        document.getElementById('usuarios-tab').style.display = tab === 'usuarios' ? 'block' : 'none';
        document.getElementById('roles-tab').style.display    = tab === 'roles'    ? 'block' : 'none';
        document.getElementById('tab-usuarios-btn').className = tab === 'usuarios' ? 'btn btn-primary' : 'btn btn-secondary';
        document.getElementById('tab-roles-btn').className    = tab === 'roles'    ? 'btn btn-primary' : 'btn btn-secondary';
    }
    </script>
</body>
</html>
