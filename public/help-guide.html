<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Ayuda - FAEN</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        .help-container {
            display: flex;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 100%;
        }

        .help-main {
            flex: 3;
            padding-right: 20px;
            min-width: 0;
        }

        .help-sidebar {
            flex: 1;
            background-color: #eee;
            padding: 20px;
            min-width: 200px;
        }

        .help-sidebar h3 {
            margin-top: 0;
        }

        .help-sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .help-sidebar ul li {
            margin-bottom: 10px;
        }

        .help-sidebar ul li a {
            color: #007bff;
            text-decoration: none;
        }

        .category-section {
            margin-bottom: 40px;
        }

        .category-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            color: #333;
        }

        .document-card {
            display: flex;
            gap: 20px;
            background: #fff;
            padding: 18px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            margin-bottom: 20px;
            align-items: flex-start;
            width: 100%;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            transition: box-shadow 0.2s, transform 0.2s;
        }

        .document-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .document-preview {
            width: 200px;
            height: 150px;
            background: #f5f5f5;
            border-radius: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .document-preview.loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .document-preview canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .document-content {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .document-content h3 {
            margin: 0 0 8px 0;
            font-size: 1.3rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            color: #333;
        }

        .document-content p {
            margin: 0 0 12px 0;
            color: #333;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .document-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 12px;
            white-space: normal;
        }

        .document-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-view, .btn-download {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            transition: background 0.2s;
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-view {
            background: #007bff;
            color: white;
        }

        .btn-view:hover {
            background: #0056b3;
        }

        .btn-download {
            background: #28a745;
            color: white;
        }

        .btn-download:hover {
            background: #218838;
        }

        .empty {
            text-align: center;
            color: #999;
            padding: 40px;
            font-size: 1rem;
        }

        .breadcrumb {
            margin: 20px auto;
            max-width: 1200px;
            padding: 0 20px;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb span {
            margin: 0 5px;
        }

        .page-header {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
            color: #333;
        }

        .page-header p {
            margin: 0;
            color: #666;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .document-card {
                flex-direction: column;
                gap: 15px;
            }

            .document-preview {
                width: 100%;
                height: 200px;
            }

            .help-container {
                flex-direction: column;
                padding: 10px;
            }

            .help-main {
                padding-right: 0;
            }

            .help-sidebar {
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <img src="images/logofaen.png" alt="Logo FAEN" class="logo">
        <h1>Gu√≠a de Ayuda</h1>
        <button class="menu-toggle" id="menu-toggle">‚ò∞</button>
        <nav id="navbar-menu">
            <ul>
                <li><a href="index.html"><span class="nav-icon">üè†</span> Inicio</a></li>
                <li><a href="help-guide.html"><span class="nav-icon">‚ùì</span> Gu√≠a</a></li>
                <li><a href="carreras.html"><span class="nav-icon">üéì</span> Carreras</a></li>
                <li><a href="autoridades.html"><span class="nav-icon">üëî</span> Autoridades</a></li>
                <li><a href="contacto.html"><span class="nav-icon">üìû</span> Contacto</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle"><span class="nav-icon">üë®‚Äçüéì</span> Estudiantes <span class="dropdown-arrow">‚ñº</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#"><span class="nav-icon">üìã</span> Preinscripci√≥n</a></li>
                        <li><a href="https://guarani.unf.edu.ar/autogestion/" target="_blank"><span class="nav-icon">üîê</span> Autogesti√≥n</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    </header>

    <div class="breadcrumb">
        <a href="index.html">Inicio</a> <span>></span> <span>Gu√≠a de Ayuda</span>
    </div>

    <div class="page-header">
        <h1>üìö Centro de Recursos</h1>
        <p>Descarga documentos √∫tiles como constancias, modelos de notas y gu√≠as de ayuda</p>
    </div>

    <div class="help-container">
        <div class="help-main" id="documentsContainer">
            <div class="empty">Cargando documentos...</div>
        </div>
        <aside class="help-sidebar">
            <h3>Secciones</h3>
            <ul id="categoriesList">
                <li><a href="#">Constancias</a></li>
                <li><a href="#">Modelos de Notas</a></li>
                <li><a href="#">Gu√≠as</a></li>
                <li><a href="#">Otros</a></li>
            </ul>
        </aside>
    </div>

    <script>
        // Configurar PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const API_BASE = 'http://localhost:3000/api';
        const categories = {
            constancias: 'üìú Constancias',
            notas: 'üìã Modelos de Notas',
            guias: 'üìñ Gu√≠as de Ayuda',
            otros: 'üìÅ Otros Documentos'
        };

        async function renderPdfThumbnail(filePath, canvasId) {
            try {
                const pdf = await pdfjsLib.getDocument(filePath).promise;
                const page = await pdf.getPage(1);
                const canvas = document.getElementById(canvasId);

                if (!canvas) return;

                const context = canvas.getContext('2d');
                const scale = 1.5;
                const viewport = page.getViewport({ scale });

                canvas.width = viewport.width;
                canvas.height = viewport.height;

                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                canvas.parentElement.classList.remove('loading');
            } catch (err) {
                console.error('Error renderizando PDF:', err);
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    canvas.parentElement.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 40px;">üìÑ</div>';
                    canvas.parentElement.classList.remove('loading');
                }
            }
        }

        async function loadDocuments() {
            try {
                const response = await fetch(`${API_BASE}/documents`);
                const documents = await response.json();

                const container = document.getElementById('documentsContainer');

                if (documents.length === 0) {
                    container.innerHTML = '<div class="empty"><p>No hay documentos disponibles en este momento</p></div>';
                    return;
                }

                // Agrupar por categor√≠a
                const grouped = {};
                documents.forEach(doc => {
                    if (!grouped[doc.category]) grouped[doc.category] = [];
                    grouped[doc.category].push(doc);
                });

                let html = '';
                let canvasCount = 0;

                Object.entries(categories).forEach(([key, label]) => {
                    if (grouped[key]) {
                        html += `<div class="category-section">
                            <div class="category-title">${label}</div>`;

                        grouped[key].forEach(doc => {
                            const canvasId = `pdf-canvas-${canvasCount++}`;
                            html += `
                                <div class="document-card">
                                    <div class="document-preview loading">
                                        <canvas id="${canvasId}"></canvas>
                                    </div>
                                    <div class="document-content">
                                        <h3>${doc.title}</h3>
                                        <p>${doc.description || 'Sin descripci√≥n'}</p>
                                        <div class="document-meta">
                                            üìÖ ${new Date(doc.uploadedAt).toLocaleDateString()} | 
                                            üìÑ ${doc.fileName}
                                        </div>
                                        <div class="document-actions">
                                            <a href="${doc.filePath}" target="_blank" class="btn-view">üëÅÔ∏è Ver PDF</a>
                                            <a href="${doc.filePath}" download class="btn-download">‚¨áÔ∏è Descargar</a>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        html += '</div>';
                    }
                });

                container.innerHTML = html;

                // Renderizar miniaturas de PDFs despu√©s de que el DOM est√© listo
                await new Promise(resolve => setTimeout(resolve, 100));
                canvasCount = 0;
                documents.forEach(doc => {
                    renderPdfThumbnail(doc.filePath, `pdf-canvas-${canvasCount++}`);
                });

            } catch (err) {
                console.error('Error al cargar documentos:', err);
                document.getElementById('documentsContainer').innerHTML = '<div class="empty"><p>Error al cargar los documentos</p></div>';
            }
        }

        // Cargar documentos cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', loadDocuments);
    </script>

    <footer>
        <p>&copy; 2026 Facultad de Administraci√≥n, Econom√≠a y Negocios</p>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>
